---
layout: admin
title: OED upgrades V1.0.0
---
<div>
    <h1>OED Upgrades Through OED v1.0.0</h1>

    <p>If you are migrating though v1.0.0 then special steps are needed. This is due to the need for a major database
        upgrade. You are doing this type of migration if the current version is below v1.0.0 but the new version is
        v1.0.0 or above. This is a onetime process so it is not needed if you are upgrading starting with a version at
        or beyond v1.0.0.</p>

    <h2>OED Script Database Migration Steps</h2>

    <h3>Introduction</h3>

    <p>The following steps are meant to migrate OED's Postgres version across multiple major versions, specifically from
        10.13 to 15.3 when going to OED v1.0.0, with the help of two scripts to automate as much of the process as
        possible. Before starting, make
        sure OED and its Docker containers are running. As with other migration work, be sure to be working in the main
        OED directory.</p>

    - TODO You must be root so can edit the postgres files, etc.

    - TODO Need to copy the two scripts from the v1.0.0 version into the old version.?????

    <h4>Running the first script</h4>

    <p>The first script is called <code>dumpDatabase.sh</code> and is located in the <code>src/scripts</code> folder.
        Run
        the script
        in the main OED directory by running the command:<br>
        <code>./src/scripts/dumpDatabase.sh</code><br>
        (try <code>bash src/sripts/dumpDatabase.sh</code> if that command doesn't work).
    </p>

    <p>The script will then run the first steps of the database migration, eventually prompting the user to reset the
        passwords for the database users oed and postgres. It will display the passwords that it should be reset to
        based on
        the environment variables, and the user must enter it in twice and make sure that no error messages occur. It is
        okay
        to copy the password shown and paste it into the requested password. Afterwards, the script will create a
        database
        dump file called <code>script_database_dump.sql</code> in the main OED directory where the script was run from.
    </p>

    <h4>Shutting down OED</h4>

    <p>The first script requires OED to be running, but the second script requires OED to be shut down. Please shut down
        OED before running the next script. See the step in the <a href="./adminUpgrading.html">admin upgrading page</a>
        for details on doing this.</p>

    <h4>Running the second script</h4>

    <p>The second script is called <code>restoreDatabase.sh</code> and is also located in the <code>src/scripts</code>
        folder. Run
        the script in the main OED directory by running the command:<br>
        <code>./src/scripts/restoreDatabase.sh</code><br>
        (try <code>bash src/sripts/restoreDatabase.sh</code> if that command doesn't work).
    </p>

    <p>The second script will remove the postgres version 10.13 database container and bring up a container with
        postgres
        version 15.3. It will restore the dump to the new database container and bring it back down again, leaving OED
        in a
        shut down state. After script finishes running successfully, the database migration is complete. If you are
        asked about
        removing a write protected directory (postgres-data) then you should answer 'y' (without the quotes). At this
        point you can continue the <a href="./adminUpgrading.html">standard upgrade process.</a></p>

    - TODO The file script_database_dump.sql exists after the process - should we get rid of in script of tell person to
    do?
    - TODO After this is done then you migrate OED but pulling the new version.
</div>